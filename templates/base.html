<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Ashen Emporium{% endblock %}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

</head>
<body>

<header class="ae-header sticky-top">
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <!-- Left: hamburger -->
      <button class="btn ae-icon-btn me-2"
              type="button"
              data-bs-toggle="offcanvas"
              data-bs-target="#aeOffcanvas"
              aria-controls="aeOffcanvas"
              aria-label="Open menu">
        <i class="fa-solid fa-bars text-light"></i>
      </button>

      <!-- Center: brand -->
      <a class="navbar-brand ae-brand mx-auto text-light" href="{% url 'home' %}">
        Ashen Emporium
      </a>

      <!-- Right: icons -->
      <div class="d-flex align-items-center gap-2">
        <a class="btn ae-icon-btn" href="{% url 'account_home' %}" aria-label="Account">
          <i class="fa-regular fa-user text-light"></i>
        </a>

        <a class="btn ae-icon-btn position-relative" href="{% url 'cart_detail' %}" aria-label="Cart">
          <i class="fa-solid fa-basket-shopping text-light"></i>
          {% if cart_count %}
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill ae-badge">
              {{ cart_count }}
            </span>
          {% endif %}
        </a>

        {% if request.user.is_authenticated %}
  <form method="post" action="{% url 'logout' %}" class="d-inline">
    {% csrf_token %}
    <button type="submit" class="btn ae-link-btn text-light">Logout</button>
  </form>
{% else %}
  <a class="btn ae-link-btn text-light" href="{% url 'login' %}">Login</a>
  <a class="btn ae-link-btn text-light" href="{% url 'register' %}">Register</a>
{% endif %}

      </div>
    </div>
  </nav>

  <!-- Offcanvas menu -->
  <div class="offcanvas offcanvas-start ae-offcanvas" tabindex="-1" id="aeOffcanvas" aria-labelledby="aeOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="aeOffcanvasLabel">Ashen Menu</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body">
      <nav class="d-grid gap-2">
        <a class="btn ae-menu-btn" href="{% url 'product_list' %}">Catalogue</a>
        <a class="btn ae-menu-btn" href="{% url 'product_list' %}?category=weapon">Weapons</a>
        <a class="btn ae-menu-btn" href="{% url 'product_list' %}?category=shield">Shields</a>
        <a class="btn ae-menu-btn" href="{% url 'product_list' %}?category=armour">Armour</a>
        <a class="btn ae-menu-btn" href="{% url 'product_list' %}?category=relic">Relics</a>
        <a class="btn ae-menu-btn" href="{% url 'product_list' %}?category=consumable">Consumables</a>
        <a class="btn ae-menu-btn" href="{% url 'product_list' %}?category=spell">Spells</a>

        {% if request.user.is_authenticated %}
  <a class="btn ae-menu-btn" href="{% url 'account_home' %}">Account</a>
{% else %}
  <a class="btn ae-menu-btn" href="{% url 'login' %}">Login</a>
  <a class="btn ae-menu-btn" href="{% url 'register' %}">Register</a>
{% endif %}

      </nav>

      <hr class="ae-divider">

<h6 class="mb-2">Filters</h6>

<form method="get" action="{% url 'product_list' %}" class="d-grid gap-2">

  <label class="form-label mb-0 muted">Category</label>
  <select class="form-select ae-select" name="category">
    <option value="">All categories</option>
    <option value="weapon">Weapons</option>
    <option value="shield">Shields</option>
    <option value="armour">Armour</option>
    <option value="relic">Relics</option>
    <option value="consumable">Consumables</option>
    <option value="spell">Spells</option>
  </select>

  <label class="form-label mb-0 muted">Rarity</label>
  <select class="form-select ae-select" name="rarity">
    <option value="">All rarities</option>
    <option value="common">Common</option>
    <option value="rare">Rare</option>
    <option value="mythic">Mythic</option>
    <option value="relic">Relic</option>
  </select>

  <div class="form-check mt-1">
    <input class="form-check-input" type="checkbox" value="1" id="inStockOnly" name="in_stock">
    <label class="form-check-label muted" for="inStockOnly">
      In stock only
    </label>
  </div>

  <!-- Keep sort available here too -->
  <label class="form-label mb-0 muted">Sort</label>
  <select class="form-select ae-select" name="sort">
    <option value="name">Name</option>
    <option value="price_asc">Price (Low → High)</option>
    <option value="price_desc">Price (High → Low)</option>
    <option value="rarity">Rarity</option>
    <option value="newest">Newest</option>
  </select>

  <!-- Preserve current search query when filtering -->
  <input type="hidden" name="q" value="{{ request.GET.q|default:'' }}">

  <button type="submit" class="btn btn-warning fw-bold">Apply filters</button>
  <a class="btn ae-menu-btn" href="{% url 'product_list' %}">Clear filters</a>
</form>

    </div>
  </div>
</header>


<main class="container">
    {% if messages %}
  <div class="messages">
    {% for message in messages %}
      <div class="message message-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  </div>
{% endif %}

    {% block content %}{% endblock %}
</main>

<footer class="footer">
    <p>© {{ now|date:"Y" }} Ashen Emporium — Forged in Cinder</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
