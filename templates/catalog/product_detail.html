{% extends "base.html" %}

{% block title %}{{ product.name }} — Ashen Emporium{% endblock %}

{% block content %}
<a class="muted" href="{% url 'product_list' %}">← Back to catalogue</a>

<div class="detail">
    <div class="detail-media">
        {% with img=product.primary_image %}
            {% if img %}
                <img class="detail-main" src="{{ img.url }}" alt="{{ product.name }}">
            {% else %}
                <div class="thumb-placeholder">No image</div>
            {% endif %}
        {% endwith %}

        {% if product.images.all %}
        <div class="gallery">
            {% for pi in product.images.all %}
                <img class="gallery-thumb" src="{{ pi.asset.image.url }}" alt="{{ pi.alt_text|default:product.name }}">
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <div class="detail-info card">
        <h1>{{ product.name }}</h1>

        <div class="tags">
            <span class="tag">{{ product.get_category_display }}</span>
            <span class="tag">{{ product.get_rarity_display }}</span>
            <span class="tag">{{ product.get_subtype_display }}</span>
            {% if product.armour_set %}
            <p class="muted" style="margin-top: 0.75rem;">
                Part of: <a href="{% url 'armour_set_detail' product.armour_set.slug %}">{{ product.armour_set.name }}</a>
            </p>
            {% endif %}

            {% if product.in_stock %}
                <span class="tag tag-ok">In stock</span>
            {% else %}
                <span class="tag tag-warn">Out of stock</span>
            {% endif %}
        </div>

        <p class="price-lg">{{ product.price_gbp }}</p>

        {% if product.in_stock %}
        <form method="post" action="{% url 'cart_add' product.id %}" class="add-cart">
            {% csrf_token %}
            <label class="muted">Qty</label>
            <input type="number" name="qty" min="1" value="1">
            <button type="submit" class="cta-button">Add to basket</button>
        </form>
        {% else %}
        <p class="muted">This item is currently unavailable.</p>
        {% endif %}

        <h3 class="section-title">Lore</h3>

        {% if product.description %}
            <div class="lore">
                {{ product.description|linebreaks }}
            </div>
        {% else %}
            <p class="muted">No lore has been inscribed for this item yet.</p>
        {% endif %}

        <div class="divider"></div>

        <p class="muted">
            SKU: <strong>{{ product.sku }}</strong>
        </p>
    </div>
</div>
{% endblock %}
